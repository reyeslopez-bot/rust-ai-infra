# 🧠 Justfile for ai-infra (Rust + SQLx + Cockroach + Neon)

default:
    @echo "Available commands:"
    @echo "  just build               # Compile entire Rust workspace"
    @echo "  just run-<crate>         # Run a specific crate binary"
    @echo "  just db                  # Connect to CockroachDB"
    @echo "  just schema-check        # Validate SQLx macros with DATABASE_URL"
    @echo "  just help                # Show this message"

# 🛠️ Build the whole Rust workspace
build:
    cargo build --workspace

# 🚀 Run individual binaries
run-agent-core:
    cargo run -p agent-core

run-service-api:
    cargo run -p service-api

run-mcp-engine:
    cargo run -p mcp-engine

run-rag-retriever:
    cargo run -p rag-retriever

# 🧪 Check schema against CockroachDB (OLTP)
schema-check:
    dotenv -f .env sqlx migrate run --database-url $DATABASE_URL_COCKROACH

# 🐚 Open a psql connection to CockroachDB (OLTP)
db:
    dotenv -f .env psql $DATABASE_URL_COCKROACH

# 🆘 Help message
help:
    just default

